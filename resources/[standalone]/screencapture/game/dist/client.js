"use strict";(()=>{var c=()=>{let e="";for(let t=0;t<32;t+=1)switch(t){case 8:case 20:e+="-",e+=(Math.random()*16|0).toString(16);break;case 12:e+="-",e+="4";break;case 16:e+="-",e+=(Math.random()*4|8).toString(16);break;default:e+=(Math.random()*16|0).toString(16)}return e};function i(e,t){AddEventHandler(`__cfx_export_screenshot-basic_${e}`,r=>{r(t)})}function f(){return c()}async function l(e,...t){return new Promise(r=>{let o=f(),n=`${e}:${o}`;emitNet(e,n,...t);let a=u=>{removeEventListener(n,a),r(u)};onNet(n,a)})}var s=new Map;RegisterNuiCallbackType("screenshot_created");onNet("screencapture:captureScreen",(e,t,r)=>{SendNUIMessage({...t,uploadToken:e,dataType:r,action:"capture",serverEndpoint:`http://${GetCurrentServerEndpoint()}/${GetCurrentResourceName()}/image`})});onNet("screencapture:INTERNAL_uploadComplete",(e,t)=>{let r=s.get(t);r&&(r(e),s.delete(t))});on("__cfx_nui:screenshot_created",(e,t)=>{if(t(!0),e.id!==void 0&&s.has(e.id)){let r=s.get(e.id);r&&(r(e.data),s.delete(e.id))}});async function m(e,t,r,o){let n=typeof r=="object"&&r!==null,a=n?r:{headers:{},encoding:"webp"},u=n?o:r,p=c();s.set(p,u);let d=await l("screencapture:INTERNAL_requestUploadToken",{...a,formField:t,url:e,correlationId:p});return d?h({...a,formField:t,url:e,uploadToken:d,dataType:"blob"}):console.error("Failed to get upload token")}i("requestScreenshotUpload",m);global.exports("requestScreenshotUpload",async(e,t,r,o)=>await m(e,t,r,o));function g(e,t){let r=c(),o=t!==void 0?e:{encoding:"jpg"},n=typeof t=="function"?t:typeof e=="function"?e:void 0;if(typeof n!="function")return console.error("Callback is not a function");s.set(r,n),h({...o,callbackUrl:`http://${GetCurrentResourceName()}/screenshot_created`,correlationId:r})}i("requestScreenshot",g);global.exports("requestScreenshot",(e,t)=>g(e,t));function h(e){SendNUIMessage({...e,action:"capture",serverEndpoint:`http://${GetCurrentServerEndpoint()}/${GetCurrentResourceName()}/image`})}})();
