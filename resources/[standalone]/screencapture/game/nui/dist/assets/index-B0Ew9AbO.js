var p=Object.defineProperty;var E=t=>{throw TypeError(t)};var x=(t,e,r)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var u=(t,e,r)=>x(t,typeof e!="symbol"?e+"":e,r),T=(t,e,r)=>e.has(t)||E("Cannot "+r);var s=(t,e,r)=>(T(t,e,"read from private field"),r?r.call(t):e.get(t)),m=(t,e,r)=>e.has(t)?E("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),h=(t,e,r,a)=>(T(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var w=`
  attribute vec2 a_position;
  attribute vec2 a_texcoord;
  uniform mat3 u_matrix;
  varying vec2 textureCoordinate;
  void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    textureCoordinate = a_texcoord;
  }
`,U=`
varying highp vec2 textureCoordinate;
uniform sampler2D external_texture;
void main()
{
  gl_FragColor = texture2D(external_texture, textureCoordinate);
}
`;function R(t,e,r){let a=t.createShader(e);if(!a)throw new Error("Failed to create shader");t.shaderSource(a,r),t.compileShader(a);let i=t.getShaderInfoLog(a);return i&&console.error(i),a}function v(t){let e=t.createTexture(),r=new Uint8Array([0,0,255,255]);return t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e}function b(t){let e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW);let r=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),t.STATIC_DRAW),{vertexBuff:e,texBuff:r}}function P(t){let e=R(t,t.VERTEX_SHADER,w),r=R(t,t.FRAGMENT_SHADER,U),a=t.createProgram();if(!a)throw new Error("Failed to create program");t.attachShader(a,e),t.attachShader(a,r),t.linkProgram(a),t.useProgram(a);let i=t.getAttribLocation(a,"a_position"),o=t.getAttribLocation(a,"a_texcoord");return{program:a,vloc:i,tloc:o}}function y(t){let e=t.getContext("webgl",{antialias:!1,depth:!1,stencil:!1,alpha:!1,desynchronized:!0,failIfMajorPerformanceCaveat:!1}),r=()=>{};function a(){let o=v(e),{program:n,vloc:l,tloc:d}=P(e),{vertexBuff:g,texBuff:A}=b(e);e.useProgram(n),e.bindTexture(e.TEXTURE_2D,o),e.uniform1i(e.getUniformLocation(n,"external_texture"),0),e.bindBuffer(e.ARRAY_BUFFER,g),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(l),e.bindBuffer(e.ARRAY_BUFFER,A),e.vertexAttribPointer(d,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(d),e.viewport(0,0,e.canvas.width,e.canvas.height),r()}let i={canvas:t,gl:e,animationFrame:void 0,disposed:!1,resize:(o,n)=>{i.disposed||(e.viewport(0,0,o,n),e.canvas.width=o,e.canvas.height=n)},dispose:()=>{if(i.disposed)return;i.disposed=!0,i.animationFrame&&(cancelAnimationFrame(i.animationFrame),i.animationFrame=void 0);let o=e.getExtension("WEBGL_lose_context");o&&o.loseContext(),t.parentNode&&t.parentNode.removeChild(t)}};return r=()=>{i.disposed||(e.drawArrays(e.TRIANGLE_STRIP,0,4),e.finish(),i.animationFrame=requestAnimationFrame(r))},a(),i}function _(...t){}var f,c;class D{constructor(){m(this,f);m(this,c,null);u(this,"MAX_WIDTH",1920);u(this,"MAX_HEIGHT",1080)}start(){window.addEventListener("message",async e=>{const r=e.data;r.action==="capture"&&await this.captureScreen(r)}),window.addEventListener("resize",()=>{s(this,f)&&s(this,f).resize(window.innerWidth,window.innerHeight)})}calculateDimensions(e){const r=window.innerWidth,a=window.innerHeight,i=e.maxWidth||this.MAX_WIDTH,o=e.maxHeight||this.MAX_HEIGHT;if(r<=i&&a<=o)return{width:r,height:a};const n=i/r,l=o/a,d=Math.min(n,l);return{width:Math.floor(r*d),height:Math.floor(a*d)}}async captureScreen(e){h(this,c,document.createElement("canvas"));const{width:r,height:a}=this.calculateDimensions(e);s(this,c).width=r,s(this,c).height=a,h(this,f,y(s(this,c))),s(this,f).resize(r,a);const i=e.encoding??"png";let o;if(e.callbackUrl?o=await this.createDataURL(s(this,c),i,e.quality):o=await this.createBlob(s(this,c),i,e.quality),!o)return console.error("No image available");await this.httpUploadImage(e,o),s(this,f).dispose(),s(this,c).remove(),h(this,f,null),h(this,c,null)}async httpUploadImage(e,r){const a=this.createRequestBody(e,r);if(e.callbackUrl){try{await fetch(e.callbackUrl,{method:"POST",mode:"cors",body:a})}catch(i){console.error(i)}return}if(e.serverEndpoint)try{await fetch(e.serverEndpoint,{method:"POST",mode:"cors",headers:{"X-ScreenCapture-Token":e.uploadToken},body:a})}catch(i){console.error(i)}}createRequestBody(e,r){if(r instanceof Blob){const a=new FormData;return a.append("file",r),a}return JSON.stringify({data:r,id:e.correlationId})}createDataURL(e,r,a){return new Promise((i,o)=>{const n=e.toDataURL(`image/${r}`,a);n||o("No data URL available"),i(n)})}createBlob(e,r,a){return new Promise((i,o)=>{const n=e.width*e.height;let l=.7;a?l=a:n>2073600?l=.5:n>144e4&&(l=.6),_(`Using quality ${l} for ${e.width}x${e.height} (${n} pixels)`),e.toBlob(d=>{d?(_(`Generated blob: ${(d.size/1024/1024).toFixed(2)}MB`),i(d)):o("No blob available")},`image/${r}`,l)})}}f=new WeakMap,c=new WeakMap;const F=new D;F.start();
